<!DOCTYPE html>
<html>
<head>
    <title>Test Admin Category Creation</title>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test Admin Category Creation</h1>
    <button id="testBtn">Test Category Creation</button>
    <div id="result"></div>

    <script>
        $(document).ready(function() {
            $('#testBtn').click(function() {
                console.log('Iniciando teste de cria√ß√£o de categoria...');
                
                // Primeiro, obter o token CSRF
                $.get('/portfolio/categories')
                    .done(function(data) {
                        console.log('P√°gina de categorias carregada');
                        
                        // Extrair o token CSRF da p√°gina
                        var csrfToken = $(data).find('meta[name="csrf-token"]').attr('content');
                        if (!csrfToken) {
                            // Tentar encontrar em um input hidden
                            csrfToken = $(data).find('input[name="_token"]').val();
                        }
                        
                        console.log('CSRF Token encontrado:', csrfToken);
                        
                        if (csrfToken) {
                            // Fazer a requisi√ß√£o POST para criar categoria
                            $.ajax({
                                url: '/portfolio/categories',
                                method: 'POST',
                                headers: {
                                    'X-CSRF-TOKEN': csrfToken,
                                    'X-Requested-With': 'XMLHttpRequest'
                                },
                                data: {
                                    name: 'Test Admin Category ' + Date.now(),
                                    description: 'Categoria de teste para admin',
                                    is_active: 1,
                                    _token: csrfToken
                                },
                                success: function(response) {
                                    console.log('‚úÖ Sucesso! Resposta:', response);
                                    $('#result').html('<div style="color: green;">‚úÖ Categoria criada com sucesso!<br>Resposta: ' + JSON.stringify(response, null, 2) + '</div>');
                                },
                                error: function(xhr, status, error) {
                                    console.log('‚ùå Erro! Status:', xhr.status);
                                    console.log('‚ùå Erro! Response:', xhr.responseText);
                                    console.log('‚ùå Erro! Headers:', xhr.getAllResponseHeaders());
                                    
                                    var errorMsg = '‚ùå Erro ao criar categoria!<br>';
                                    errorMsg += 'Status: ' + xhr.status + '<br>';
                                    errorMsg += 'Error: ' + error + '<br>';
                                    errorMsg += 'Response: <pre>' + xhr.responseText + '</pre>';
                                    
                                    $('#result').html('<div style="color: red;">' + errorMsg + '</div>');
                                    
                                    // Verificar se a resposta √© HTML em vez de JSON
                                    if (xhr.responseText.includes('<!DOCTYPE') || xhr.responseText.includes('<html')) {
                                        console.log('üîç A resposta √© HTML em vez de JSON!');
                                        $('#result').append('<div style="color: orange;">üîç PROBLEMA IDENTIFICADO: A resposta √© HTML em vez de JSON!</div>');
                                    }
                                }
                            });
                        } else {
                            console.log('‚ùå Token CSRF n√£o encontrado');
                            $('#result').html('<div style="color: red;">‚ùå Token CSRF n√£o encontrado</div>');
                        }
                    })
                    .fail(function(xhr, status, error) {
                        console.log('‚ùå Erro ao carregar p√°gina de categorias:', error);
                        $('#result').html('<div style="color: red;">‚ùå Erro ao carregar p√°gina de categorias: ' + error + '</div>');
                    });
            });
        });
    </script>
</body>
</html>